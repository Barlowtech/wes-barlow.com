---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import StatusBadge from '../../components/StatusBadge.astro';
import TagPill from '../../components/TagPill.astro';

export async function getStaticPaths() {
  const fiction = await getCollection('fiction');
  return fiction.map(entry => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Format date
const formattedDate = new Date(entry.data.date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.tagline}
>
  <!-- Hero Section with Book Jacket Feel -->
  <section class="relative w-full py-16 md:py-24 px-6 bg-bg-primary border-b border-border">
    <div class="max-w-4xl mx-auto">
      <!-- Status and Date -->
      <div class="flex items-center gap-4 mb-8">
        <StatusBadge status={entry.data.status} />
        <span class="text-sm text-text-secondary font-body">
          {formattedDate}
        </span>
      </div>

      <!-- Title -->
      <h1 class="text-5xl md:text-6xl lg:text-7xl font-heading font-bold text-text-primary mb-6 leading-tight">
        {entry.data.title}
      </h1>

      <!-- Tagline as Subtitle -->
      <p class="text-2xl text-accent-creative font-heading mb-8 leading-relaxed max-w-2xl">
        {entry.data.tagline}
      </p>

      <!-- Genre Tags -->
      {entry.data.genre.length > 0 && (
        <div class="flex flex-wrap gap-3">
          {entry.data.genre.map((genre) => (
            <TagPill tag={genre} accent="#d4a04a" />
          ))}
        </div>
      )}
    </div>

    <!-- Subtle accent bar -->
    <div class="absolute top-0 left-0 right-0 h-1 bg-accent-creative"></div>
  </section>

  <!-- Cover Image Area -->
  {entry.data.cover && (
    <section class="w-full px-6 py-8 bg-bg-surface/50">
      <div class="max-w-4xl mx-auto">
        <img
          src={entry.data.cover}
          alt={entry.data.title}
          class="w-full h-auto rounded-lg border border-border shadow-lg"
        />
      </div>
    </section>
  )}

  <!-- Content -->
  <section class="w-full py-16 md:py-24 px-6 bg-bg-primary">
    <div class="max-w-3xl mx-auto prose">
      <Content />
    </div>
  </section>

  <!-- Navigation Back -->
  <section class="w-full py-12 px-6 bg-bg-surface/50 border-t border-border">
    <div class="max-w-4xl mx-auto">
      <a
        href="/fiction/"
        class="inline-flex items-center gap-2 text-accent-creative hover:text-accent-creative/80 font-heading font-bold uppercase tracking-widest transition-colors"
      >
        <svg
          class="w-4 h-4 rotate-180"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        <span>Back to Fiction</span>
      </a>
    </div>
  </section>
</BaseLayout>
